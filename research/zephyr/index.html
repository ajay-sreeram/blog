
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A deep dive into the matrix of tech and code">
      
      
        <meta name="author" content="Sreeram Ajay">
      
      
      
      
      
      <link rel="icon" href="../../my_icon_nobg.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>The Evolution of Small Language Models: Aligning to the Intent of the user with Zephyr - Code & Conversations</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-evolution-of-small-language-models-aligning-to-the-intent-of-the-user-with-zephyr" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Code &amp; Conversations" class="md-header__button md-logo" aria-label="Code & Conversations" data-md-component="logo">
      
  <img src="../../my_icon_nobg.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Code & Conversations
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Evolution of Small Language Models: Aligning to the Intent of the user with Zephyr
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link">
        
  
    
  
  Research

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../coding/" class="md-tabs__link">
        
  
    
  
  Coding

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../learning/" class="md-tabs__link">
        
  
    
  
  Notes

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tech-updates/" class="md-tabs__link">
        
  
    
  
  Tech Updates

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../generated/" class="md-tabs__link">
        
  
    
  
  Generated

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Code &amp; Conversations" class="md-nav__button md-logo" aria-label="Code & Conversations" data-md-component="logo">
      
  <img src="../../my_icon_nobg.png" alt="logo">

    </a>
    Code & Conversations
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Research
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Coding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../tech-updates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tech Updates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generated
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-need-for-intent-alignment" class="md-nav__link">
    The Need for Intent Alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-distillation-method" class="md-nav__link">
    The Distillation Method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zephyr-direct-distillation-of-lm-alignment" class="md-nav__link">
    ZEPHYR -  Direct Distillation Of LM Alignment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-stages-of-progress-from-dsft-to-ddpo" class="md-nav__link">
    The Stages of Progress: From dSFT to dDPO
  </a>
  
    <nav class="md-nav" aria-label="The Stages of Progress: From dSFT to dDPO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-distilled-supervised-fine-tuning-dsft" class="md-nav__link">
    1. Distilled Supervised Fine-Tuning (dSFT)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ai-feedback-through-preferences-aif" class="md-nav__link">
    2. AI Feedback through Preferences (AIF)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-distilled-direct-preference-optimization-ddpo" class="md-nav__link">
    3. Distilled Direct Preference Optimization (dDPO)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-example" class="md-nav__link">
    An Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">Finetuning</span>
    
  
    
    
    
      <span class="md-tag">SLM</span>
    
  
    
    
    
      <span class="md-tag">NLG</span>
    
  
</nav>



<h1 id="the-evolution-of-small-language-models-aligning-to-the-intent-of-the-user-with-zephyr">The Evolution of Small Language Models: Aligning to the Intent of the user with Zephyr</h1>
<p><img alt="Zephyr" src="../images/zephyr/title1_1.png" style="height:250px; width:400px; display: block;margin-left: auto;margin-right: auto;" /></p>
<p>Technological advancements in natural language models have been remarkable, culminating in large and robust systems capable of a variety of tasks. While large proprietary models are at the forefront of this evolution, smaller open models are catching up, especially in their ability to align with human intent, a crucial aspect for user experience in conversational systems.</p>
<h2 id="the-need-for-intent-alignment">The Need for Intent Alignment</h2>
<p>One of the key issues with these models is their lack of "intent alignment". In layman's terms, this means that these models don't always respond in the way humans would prefer. They may generate text that is grammatically correct but doesn't quite get to the heart of what the user is asking. There have been benchmarks like MT-Bench and AlpacaEval developed to specifically measure this characteristic. According to these, proprietary models tend to outperform their open counterparts, but the cost of human annotation to improve them is exorbitant.</p>
<h2 id="the-distillation-method">The Distillation Method</h2>
<p>Here's where distillation comes in. Distillation is essentially a "teaching" method where a smaller model (student) learns from a larger, more capable model (teacher). It's like learning shorthand notes from an expert's extensive lecture.</p>
<h2 id="zephyr-direct-distillation-of-lm-alignment">ZEPHYR -  Direct Distillation Of LM Alignment</h2>
<p>Zephyr<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> aims to align with user intent throw three stages as below.</p>
<p><img alt="Zephyr Steps" src="../images/zephyr/title2.png" style="height:350px; width:700px; display: block;margin-left: auto;margin-right: auto;" /></p>
<hr />
<h2 id="the-stages-of-progress-from-dsft-to-ddpo">The Stages of Progress: From dSFT to dDPO</h2>
<h3 id="1-distilled-supervised-fine-tuning-dsft">1. Distilled Supervised Fine-Tuning (dSFT)</h3>
<p>The process begins with the Distilled Supervised Fine-Tuning (dSFT) stage. Here, the student model is trained to respond to user prompts. Traditional methods usually use a dataset comprising high-quality instructions and responses. However, this research proposes a novel twist: why not use the teacher model to generate these instructions and responses?</p>
<blockquote>
<p>Let x₁, . . . , xⱼ be a set of seed prompts, constructed to represent a diverse set of topical domains. A dataset is constructed through iterative self-prompting where the teacher is used to both respond to an instruction and refine the instruction based on the response.</p>
</blockquote>
<p>This method, also known as "distilled SFT," essentially involves having the teacher model guide the training of the student model.</p>
<h3 id="2-ai-feedback-through-preferences-aif">2. AI Feedback through Preferences (AIF)</h3>
<p>Usually, human feedback is used to further improve the alignment of these language models. However, the research introduces a twist—using AI-generated preferences for distillation.</p>
<blockquote>
<p>For distillation, we instead use AI preferences from the teacher model on generated outputs from other models.</p>
</blockquote>
<p>In this method, multiple models generate responses to a set of queries. These responses are then ranked by the teacher model, creating a new dataset. This dataset includes the best and a randomly chosen lower-scoring response, forming "triples" of data that guide the student model in recognizing more and less favorable outputs</p>
<h3 id="3-distilled-direct-preference-optimization-ddpo">3. Distilled Direct Preference Optimization (dDPO)</h3>
<p>Refine the student model by optimizing throw a reward function that ranks the preferred response over lesser ones.</p>
<blockquote>
<p>The goal of the final step is to refine the πdSFT by maximizing the likelihood of ranking the preferred Yw over Yl in a preference model.</p>
</blockquote>
<p>The core idea is to implement a reward function, often denoted as rθ(x,y), that is influenced by the "teacher" model's preferences. This function forms the basis of a preference model that aims to rank a higher-scoring response  over a lower-scoring one.</p>
<hr />
<h2 id="an-example">An Example</h2>
<p class="annotate">Below is a nice example<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> showing <strong>Zephyr's</strong>(1) ability to keep track of complex scenarios</p>
<ol>
<li><em>Zephyr is like teaching a chatbot to talk smarter by first giving it basic lessons, then getting tips from a smarter chatbot, and finally polishing its answers to be top-notch.</em></li>
</ol>
<p><strong>I went to the market and bought 10 apples. I gave 2 apples to the neighbor and 2 to the repairman. I then went and bought 5 more apples and ate 1. I also gave 3 bananas to my brother. How many apples did I remain with?</strong></p>
<blockquote>
<p>After buying 10 apples, you gave away 2 apples to your neighbor and 2 apples to the repairman. This left you with a total of 6 apples. Then, you went back to the market and bought another 5 apples. You ate one of them, which left you with 4 more apples. In total, you now have 10 apples from your initial purchase (6 from the first time plus 4 from the second time).</p>
<p>Additionally, you gave away 3 bananas to your brother. Since we don't know how many bananas you had before giving them away, we can't include them in this calculation. However, let's assume that you didn't have any bananas before going to the market. In that case, you would now have a total of 10 apples and no bananas remaining.</p>
<p>To summarize, after all your transactions, you remain with a total of 10 apples but no bananas.</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>With the advent of methods like dDPO and models like ZEPHYR-7B, we're stepping into an era where small open language models can be as useful and aligned with human preferences as their larger, proprietary counterparts. It marks a democratization of technology where advanced conversational agents can be developed and deployed at a fraction of the cost. The future is not just about building bigger models but about making them smarter, aligned, and perhaps, more human-like.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://arxiv.org/abs/2310.16944">Step back prompting:</a> https://arxiv.org/abs/2310.16944&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.reddit.com/r/LocalLLaMA/comments/17ioeoa/zephyr_7b_beta_is_awesome_examples/">Reddit post about Zephyr with examples</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 1, 2023</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.code.copy", "content.code.select"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../scripts/twitter_widgets.js"></script>
      
        <script src="../../scripts/embed_tweets.js"></script>
      
    
  </body>
</html>